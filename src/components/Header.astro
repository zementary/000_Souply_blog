---
import { Image } from 'astro:assets';
import logo from '@/assets/logo.png';

interface Props {
  isCinemaMode?: boolean;
}

const { isCinemaMode = false } = Astro.props;
---

<header 
  id="site-header"
  class={`sticky top-0 z-50 border-b transition-all duration-500 ${
    isCinemaMode 
      ? 'bg-[#050505]/0 border-[#050505]/0 opacity-0 hover:opacity-100 hover:bg-[#050505]/95 hover:border-zinc-800' 
      : 'bg-white/95 backdrop-blur-sm border-zinc-200'
  }`}
  data-cinema-mode={isCinemaMode}
>
  <div class="container mx-auto px-3 md:px-8 py-3 md:py-6">
    <div class="flex flex-row justify-between items-stretch gap-2 md:gap-8">
      <!-- Left Side: Logo + Tagline -->
      <div class="flex flex-col justify-between">
        <!-- Logo (Larger) -->
        <a href="/" class="block transition-opacity hover:opacity-70">
          <Image 
            src={logo} 
            alt="Souply Logo" 
            height={128}
            class="h-12 md:h-28 lg:h-32 w-auto"
          />
        </a>
        <!-- Single Line Tagline -->
        <p class={`mt-1 md:mt-2 flex flex-col sm:flex-row sm:items-baseline ${isCinemaMode ? 'text-gray-400' : ''}`}>
          <span class={`font-serif italic text-xs md:text-sm lg:text-base ${isCinemaMode ? 'text-gray-500' : 'text-gray-600'}`}>
            Sub specie aeternitatis
          </span>
          <span class="mx-2 opacity-50 text-gray-400 hidden sm:inline">/</span>
          <span class="font-sans font-bold text-[9px] md:text-[10px] tracking-[0.2em] uppercase text-gray-400">
            Music, Visualized
          </span>
        </p>
      </div>

      <!-- Right Side: Mirrored Two-row Vertical Nav -->
      <nav class="flex flex-col items-end justify-between self-stretch">
        <!-- Row 1 (Top): Social Icons - Aligned with Logo -->
        <div class="flex items-center gap-3">
          <!-- Instagram -->
          <a
            href="https://instagram.com/souplytv"
            target="_blank"
            rel="noopener noreferrer"
            class={`transition-colors ${
              isCinemaMode ? 'text-zinc-600 hover:text-zinc-300' : 'text-zinc-600 hover:text-black'
            }`}
            aria-label="Souply Instagram"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
              <path d="M17.34,5.46h0a1.2,1.2,0,1,0,1.2,1.2A1.2,1.2,0,0,0,17.34,5.46Zm4.6,2.42a7.59,7.59,0,0,0-.46-2.43,4.94,4.94,0,0,0-1.16-1.77,4.7,4.7,0,0,0-1.77-1.15,7.3,7.3,0,0,0-2.43-.47C15.06,2,14.72,2,12,2s-3.06,0-4.12.06a7.3,7.3,0,0,0-2.43.47A4.78,4.78,0,0,0,3.68,3.68,4.7,4.7,0,0,0,2.53,5.45a7.3,7.3,0,0,0-.47,2.43C2,8.94,2,9.28,2,12s0,3.06.06,4.12a7.3,7.3,0,0,0,.47,2.43,4.7,4.7,0,0,0,1.15,1.77,4.78,4.78,0,0,0,1.77,1.15,7.3,7.3,0,0,0,2.43.47C8.94,22,9.28,22,12,22s3.06,0,4.12-.06a7.3,7.3,0,0,0,2.43-.47,4.7,4.7,0,0,0,1.77-1.15,4.85,4.85,0,0,0,1.16-1.77,7.59,7.59,0,0,0,.46-2.43c0-1.06.06-1.4.06-4.12S22,8.94,21.94,7.88ZM20.14,16a5.61,5.61,0,0,1-.34,1.86,3.06,3.06,0,0,1-.75,1.15,3.19,3.19,0,0,1-1.15.75,5.61,5.61,0,0,1-1.86.34c-1,.05-1.37.06-4,.06s-3,0-4-.06A5.73,5.73,0,0,1,6.1,19.8,3.27,3.27,0,0,1,5,19.05a3,3,0,0,1-.74-1.15A5.54,5.54,0,0,1,3.86,16c0-1-.06-1.37-.06-4s0-3,.06-4A5.54,5.54,0,0,1,4.21,6.1,3,3,0,0,1,5,5,3.14,3.14,0,0,1,6.1,4.2,5.73,5.73,0,0,1,8,3.86c1,0,1.37-.06,4-.06s3,0,4,.06a5.61,5.61,0,0,1,1.86.34A3.06,3.06,0,0,1,19.05,5,3.06,3.06,0,0,1,19.8,6.1,5.61,5.61,0,0,1,20.14,8c.05,1,.06,1.37.06,4S20.19,15,20.14,16ZM12,6.87A5.13,5.13,0,1,0,17.14,12,5.12,5.12,0,0,0,12,6.87Zm0,8.46A3.33,3.33,0,1,1,15.33,12,3.33,3.33,0,0,1,12,15.33Z"/>
            </svg>
          </a>
          <!-- Xiaohongshu -->
          <a
            href="https://www.xiaohongshu.com/user/profile/62bc5247000000001902a3a7"
            target="_blank"
            rel="noopener noreferrer"
            class={`transition-colors ${
              isCinemaMode ? 'text-zinc-600 hover:text-zinc-300' : 'text-zinc-600 hover:text-black'
            }`}
            aria-label="Souply Xiaohongshu"
          >
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5">
              <path d="M22.405 9.879c0.002 0.016 0.01 0.02 0.07 0.019h0.725a0.797 0.797 0 0 0 0.78 -0.972 0.794 0.794 0 0 0 -0.884 -0.618 0.795 0.795 0 0 0 -0.692 0.794c0 0.101 -0.002 0.666 0.001 0.777zm-11.509 4.808c-0.203 0.001 -1.353 0.004 -1.685 0.003a2.528 2.528 0 0 1 -0.766 -0.126 0.025 0.025 0 0 0 -0.03 0.014L7.7 16.127a0.025 0.025 0 0 0 0.01 0.032c0.111 0.06 0.336 0.124 0.495 0.124 0.66 0.01 1.32 0.002 1.981 0 0.01 0 0.02 -0.006 0.023 -0.015l0.712 -1.545a0.025 0.025 0 0 0 -0.024 -0.036zM0.477 9.91c-0.071 0 -0.076 0.002 -0.076 0.01a0.834 0.834 0 0 0 -0.01 0.08c-0.027 0.397 -0.038 0.495 -0.234 3.06 -0.012 0.24 -0.034 0.389 -0.135 0.607 -0.026 0.057 -0.033 0.042 0.003 0.112 0.046 0.092 0.681 1.523 0.787 1.74 0.008 0.015 0.011 0.02 0.017 0.02 0.008 0 0.033 -0.026 0.047 -0.044 0.147 -0.187 0.268 -0.391 0.371 -0.606 0.306 -0.635 0.44 -1.325 0.486 -1.706 0.014 -0.11 0.021 -0.22 0.03 -0.33l0.204 -2.616 0.022 -0.293c0.003 -0.029 0 -0.033 -0.03 -0.034zm7.203 3.757a1.427 1.427 0 0 1 -0.135 -0.607c-0.004 -0.084 -0.031 -0.39 -0.235 -3.06a0.443 0.443 0 0 0 -0.01 -0.082c-0.004 -0.011 -0.052 -0.008 -0.076 -0.008h-1.48c-0.03 0.001 -0.034 0.005 -0.03 0.034l0.021 0.293c0.076 0.982 0.153 1.964 0.233 2.946 0.05 0.4 0.186 1.085 0.487 1.706 0.103 0.215 0.223 0.419 0.37 0.606 0.015 0.018 0.037 0.051 0.048 0.049 0.02 -0.003 0.742 -1.642 0.804 -1.765 0.036 -0.07 0.03 -0.055 0.003 -0.112zm3.861 -0.913h-0.872a0.126 0.126 0 0 1 -0.116 -0.178l1.178 -2.625a0.025 0.025 0 0 0 -0.023 -0.035l-1.318 -0.003a0.148 0.148 0 0 1 -0.135 -0.21l0.876 -1.954a0.025 0.025 0 0 0 -0.023 -0.035h-1.56c-0.01 0 -0.02 0.006 -0.024 0.015l-0.926 2.068c-0.085 0.169 -0.314 0.634 -0.399 0.938a0.534 0.534 0 0 0 -0.02 0.191 0.46 0.46 0 0 0 0.23 0.378 0.981 0.981 0 0 0 0.46 0.119h0.59c0.041 0 -0.688 1.482 -0.834 1.972a0.53 0.53 0 0 0 -0.023 0.172 0.465 0.465 0 0 0 0.23 0.398c0.15 0.092 0.342 0.12 0.475 0.12l1.66 -0.001c0.01 0 0.02 -0.006 0.023 -0.015l0.575 -1.28a0.025 0.025 0 0 0 -0.024 -0.035zm-6.93 -4.937H3.1a0.032 0.032 0 0 0 -0.034 0.033c0 1.048 -0.01 2.795 -0.01 6.829 0 0.288 -0.269 0.262 -0.28 0.262h-0.74c-0.04 0.001 -0.044 0.004 -0.04 0.047 0.001 0.037 0.465 1.064 0.555 1.263 0.01 0.02 0.03 0.033 0.051 0.033 0.157 0.003 0.767 0.009 0.938 -0.014 0.153 -0.02 0.3 -0.06 0.438 -0.132 0.3 -0.156 0.49 -0.419 0.595 -0.765 0.052 -0.172 0.075 -0.353 0.075 -0.533 0.002 -2.33 0 -4.66 -0.007 -6.991a0.032 0.032 0 0 0 -0.032 -0.032zm11.784 6.896c0 -0.014 -0.01 -0.021 -0.024 -0.022h-1.465c-0.048 -0.001 -0.049 -0.002 -0.05 -0.049v-4.66c0 -0.072 -0.005 -0.07 0.07 -0.07h0.863c0.08 0 0.075 0.004 0.075 -0.074V8.393c0 -0.082 0.006 -0.076 -0.08 -0.076h-3.5c-0.064 0 -0.075 -0.006 -0.075 0.073v1.445c0 0.083 -0.006 0.077 0.08 0.077h0.854c0.075 0 0.07 -0.004 0.07 0.07v4.624c0 0.095 0.008 0.084 -0.085 0.084 -0.37 0 -1.11 -0.002 -1.304 0 -0.048 0.001 -0.06 0.03 -0.06 0.03l-0.697 1.519s-0.014 0.025 -0.008 0.036c0.006 0.01 0.013 0.008 0.058 0.008 1.748 0.003 3.495 0.002 5.243 0.002 0.03 -0.001 0.034 -0.006 0.035 -0.033v-1.539zm4.177 -3.43c0 0.013 -0.007 0.023 -0.02 0.024 -0.346 0.006 -0.692 0.004 -1.037 0.004 -0.014 -0.002 -0.022 -0.01 -0.022 -0.024 -0.005 -0.434 -0.007 -0.869 -0.01 -1.303 0 -0.072 -0.006 -0.071 0.07 -0.07l0.733 -0.003c0.041 0 0.081 0.002 0.12 0.015 0.093 0.025 0.16 0.107 0.165 0.204 0.006 0.431 0.002 1.153 0.001 1.153zm2.67 0.244a1.953 1.953 0 0 0 -0.883 -0.222h-0.18c-0.04 -0.001 -0.04 -0.003 -0.042 -0.04V10.21c0 -0.132 -0.007 -0.263 -0.025 -0.394a1.823 1.823 0 0 0 -0.153 -0.53 1.533 1.533 0 0 0 -0.677 -0.71 2.167 2.167 0 0 0 -1 -0.258c-0.153 -0.003 -0.567 0 -0.72 0 -0.07 0 -0.068 0.004 -0.068 -0.065V7.76c0 -0.031 -0.01 -0.041 -0.046 -0.039H17.93s-0.016 0 -0.023 0.007c-0.006 0.006 -0.008 0.012 -0.008 0.023v0.546c-0.008 0.036 -0.057 0.015 -0.082 0.022h-0.95c-0.022 0.002 -0.028 0.008 -0.03 0.032v1.481c0 0.09 -0.004 0.082 0.082 0.082h0.913c0.082 0 0.072 0.128 0.072 0.128v1.148s0.003 0.117 -0.06 0.117h-1.482c-0.068 0 -0.06 0.082 -0.06 0.082v1.445s-0.01 0.068 0.064 0.068h1.457c0.082 0 0.076 -0.006 0.076 0.079v3.225c0 0.088 -0.007 0.081 0.082 0.081h1.43c0.09 0 0.082 0.007 0.082 -0.08v-3.27c0 -0.029 0.006 -0.035 0.033 -0.035l2.323 -0.003c0.098 0 0.191 0.02 0.28 0.061a0.46 0.46 0 0 1 0.274 0.407c0.008 0.395 0.003 0.79 0.003 1.185 0 0.259 -0.107 0.367 -0.33 0.367h-1.218c-0.023 0.002 -0.029 0.008 -0.028 0.033 0.184 0.437 0.374 0.871 0.57 1.303a0.045 0.045 0 0 0 0.04 0.026c0.17 0.005 0.34 0.002 0.51 0.003 0.15 -0.002 0.517 0.004 0.666 -0.01a2.03 2.03 0 0 0 0.408 -0.075c0.59 -0.18 0.975 -0.698 0.976 -1.313v-1.981c0 -0.128 -0.01 -0.254 -0.034 -0.38 0 0.078 -0.029 -0.641 -0.724 -0.998z"/>
            </svg>
          </a>
          <!-- Discord -->
          <span
            class={`opacity-30 cursor-default ${
              isCinemaMode ? 'text-zinc-600' : 'text-zinc-600'
            }`}
            title="Coming Soon"
            aria-label="Discord Coming Soon"
          >
            <svg viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
              <path d="M20.317 4.369a19.789 19.789 0 0 0-4.885-1.514.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.616 12.616 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.069.069 0 0 0-.032.027C.533 9.045-.32 13.58.099 18.057a.08.08 0 0 0 .031.057 19.896 19.896 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.031 14.031 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.078 13.078 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.196 10.196 0 0 0 .372-.292.073.073 0 0 1 .077-.01c3.927 1.793 8.18 1.793 12.062 0a.073.073 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.29 12.29 0 0 1-1.872.892.077.077 0 0 0-.041.107c.36.697.772 1.362 1.225 1.993a.077.077 0 0 0 .084.028 19.836 19.836 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.176-.838-9.674-3.549-13.66a.062.062 0 0 0-.031-.03zM8.02 15.329c-1.183 0-2.157-1.085-2.157-2.419 0-1.334.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.419 0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.334.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.419 0 1.334-.946 2.419-2.157 2.419z"/>
            </svg>
          </span>
        </div>
        
        <!-- Row 2 (Bottom): About + Search - Aligned with Tagline -->
        <div class="flex items-center gap-3 md:gap-4">
          <a 
            href="/about" 
            class={`text-[10px] tracking-widest uppercase font-medium hover:underline transition-colors ${
              isCinemaMode ? 'text-gray-400 hover:text-gray-200' : 'text-zinc-600 hover:text-zinc-900'
            }`}
          >
            About
          </a>
          <button 
            id="search-trigger"
            class={`flex items-center gap-2 px-2 py-1.5 rounded-lg transition-colors text-xs ${
              isCinemaMode 
                ? 'bg-zinc-800/50 hover:bg-zinc-700/50 text-gray-300' 
                : 'bg-zinc-100 hover:bg-zinc-200 text-zinc-700'
            }`}
            aria-label="Open search"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <span class="hidden md:inline-flex items-center gap-2">
              <span>Search</span>
              <kbd class={`items-center px-1.5 py-0.5 text-[10px] font-semibold rounded border ${
                isCinemaMode 
                  ? 'text-gray-400 bg-zinc-900 border-zinc-700' 
                  : 'text-zinc-500 bg-white border-zinc-300'
              }`}>
                âŒ˜K
              </kbd>
            </span>
          </button>
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  // Trigger search panel to open
  document.getElementById('search-trigger')?.addEventListener('click', () => {
    window.dispatchEvent(new CustomEvent('open-search'));
  });

  // Cinema Mode: Smart Header Reveal
  const header = document.getElementById('site-header');
  const isCinemaMode = header?.getAttribute('data-cinema-mode') === 'true';

  if (isCinemaMode) {
    let hideTimeout;

    const showHeader = () => {
      header?.classList.remove('opacity-0');
      header?.classList.add('opacity-100');
      clearTimeout(hideTimeout);
      
      // Auto-hide after 3 seconds of no movement
      hideTimeout = window.setTimeout(() => {
        header?.classList.remove('opacity-100');
        header?.classList.add('opacity-0');
      }, 3000);
    };

    const hideHeader = () => {
      clearTimeout(hideTimeout);
      header?.classList.remove('opacity-100');
      header?.classList.add('opacity-0');
    };

    // Show header when mouse is near top
    document.addEventListener('mousemove', (e) => {
      if (e.clientY < 100) {
        showHeader();
      }
    });

    // Also show on any mouse movement, but hide after delay
    let mouseMoveTimeout;
    document.addEventListener('mousemove', () => {
      clearTimeout(mouseMoveTimeout);
      mouseMoveTimeout = window.setTimeout(() => {
        if (header?.matches(':hover') === false) {
          hideHeader();
        }
      }, 100);
    });
  }
</script>

